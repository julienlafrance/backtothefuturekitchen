Standards Qualit√©
=================

Ce projet respecte les standards de qualit√© pour un projet Python moderne.

**Voir aussi** : :doc:`tests` (coverage 93%), :doc:`cicd` (pipeline automatis√©), :doc:`architecture` (stack technique)

Gestion de Projet
-----------------

Structure Coh√©rente
^^^^^^^^^^^^^^^^^^^

* Packages organis√©s : ``utils/``, ``visualization/``, ``data/``
* Modules s√©par√©s par fonctionnalit√©
* S√©paration logique code/tests/documentation

Environnement Python
^^^^^^^^^^^^^^^^^^^^

* Gestionnaire moderne : ``uv`` (rempla√ßant pip)
* Configuration : ``pyproject.toml``
* Environnement virtuel isol√©
* D√©pendances versionn√©es

Git et GitHub
^^^^^^^^^^^^^

* Commits r√©guliers et descriptifs
* Branches de d√©veloppement
* Pull Requests avec review
* Historique tra√ßable

Documentation
^^^^^^^^^^^^^

* README.md complet (installation, utilisation)
* Documentation Sphinx auto-g√©n√©r√©e
* Guides techniques (CI/CD, tests, S3)
* Docstrings sur toutes les fonctions

Streamlit
^^^^^^^^^

* Interface utilisateur intuitive
* Widgets interactifs (sliders, selectbox)
* Storytelling des analyses
* Graphiques Plotly dynamiques

Programmation
-------------

Programmation Orient√©e Objet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Classes impl√©ment√©es dans le projet :

**Classe DataLoader** (``data.loaders``)

Gestion du chargement de donn√©es avec exceptions :

.. code-block:: python

   class DataLoader:
       def load_recipes(self) -> pl.DataFrame:
           """Charge recettes depuis S3 avec gestion erreurs."""

       def load_ratings(
           self,
           min_interactions: int = 100,
           return_metadata: bool = False,
           verbose: bool = False
       ) -> pl.DataFrame | tuple:
           """Charge ratings avec options configurables."""

**Hi√©rarchie Exceptions** (``exceptions.py``)

6 classes d'exceptions personnalis√©es :

.. code-block:: python

   class MangetamainError(Exception):
       """Exception de base."""

   class DataLoadError(MangetamainError):
       """Erreur chargement S3/DuckDB."""
       def __init__(self, source: str, detail: str): ...

   class AnalysisError(MangetamainError):
       """Erreur analyse statistique."""

   class ConfigurationError(MangetamainError):
       """Erreur configuration."""

   class DatabaseError(MangetamainError):
       """Erreur op√©rations DuckDB."""

   class ValidationError(MangetamainError):
       """Erreur validation donn√©es."""

**Autres Classes**

* Configuration environnement (logging, d√©tection preprod/prod)
* Utilitaires graphiques (application th√®me, gestion couleurs)

Type Hinting
^^^^^^^^^^^^

Annotations de types compl√®tes :

.. code-block:: python

   def apply_chart_theme(fig: go.Figure, title: str = None) -> go.Figure:
       """Applique le th√®me √† un graphique."""
       pass

   def get_ratings_longterm(
       min_interactions: int = 100,
       return_metadata: bool = False,
       verbose: bool = False
   ) -> pd.DataFrame:
       """Charge les ratings depuis S3."""
       pass

Respect PEP8
^^^^^^^^^^^^

* Validation automatique avec ``flake8``
* Formatage avec ``black``
* Ligne maximale : 88 caract√®res
* Pipeline CI v√©rifie √† chaque push

Gestion des Exceptions
^^^^^^^^^^^^^^^^^^^^^^^

Try/except personnalis√©s avec messages clairs :

.. code-block:: python

   try:
       data = load_from_s3(bucket, key)
   except boto3.exceptions.NoCredentialsError:
       st.error("Credentials S3 introuvables. V√©rifier 96_keys/credentials")
   except Exception as e:
       st.error(f"Erreur chargement donn√©es : {e}")
       return None

Logging
^^^^^^^

Syst√®me Loguru 0.7.3 complet avec s√©paration PREPROD/PROD :

* **Architecture** : 2 fichiers (debug.log, errors.log) par environnement
* **D√©tection auto** : Variable ``APP_ENV`` ou path automatique
* **Rotation** : 10 MB (debug), 5 MB (errors) avec compression
* **Thread-safe** : ``enqueue=True`` pour Streamlit multithread
* **Backtrace** : Diagnostic complet des erreurs

.. code-block:: python

   from loguru import logger

   def load_data():
       try:
           logger.info("Starting data load")
           data = load_from_s3()
           logger.success(f"Loaded {len(data)} records")
       except Exception as e:
           logger.error(f"Load failed: {e}")
           raise

**Voir** : :doc:`architecture` section Logging pour configuration compl√®te.

√âv√©nements Loggu√©s
^^^^^^^^^^^^^^^^^^

L'application Streamlit enregistre **21 √©v√©nements** dans les fichiers de log.

**main.py (13 √©v√©nements)**

D√©marrage application:

* ``logger.info`` (519) : "üöÄ Enhanced Streamlit application starting"
* ``logger.info`` (833) : "‚úÖ Application fully loaded"
* ``logger.info`` (837) : "üåü Starting Enhanced Mangetamain Analytics"

Ressources et v√©rifications:

* ``logger.warning`` (527) : "CSS file not found: {css_path}"
* ``logger.warning`` (633) : "S3 not accessible: {e}"
* ``logger.warning`` (636) : "Unexpected error checking S3: {e}"

Erreurs analyses:

* ``logger.warning`` (246) : "Erreur lors de l'analyse de {table}: {e}"
* ``logger.error`` (315) : "DatabaseError in temporal analysis: {e}"
* ``logger.error`` (318) : "AnalysisError in temporal analysis: {e}"
* ``logger.error`` (321) : "Unexpected error in temporal analysis: {e}"
* ``logger.error`` (381) : "DatabaseError in user analysis: {e}"
* ``logger.error`` (384) : "AnalysisError in user analysis: {e}"
* ``logger.error`` (387) : "Unexpected error in user analysis: {e}"

**Chargement donn√©es (data/loaders.py - 8 √©v√©nements)**

Le chargement des fichiers Parquet depuis S3 g√©n√®re des logs d√©taill√©s avec gestion d'erreurs via ``DataLoadError`` :

Chargement recettes :

* ``logger.error`` (40) : \"Module mangetamain_data_utils introuvable: {e}\"
* ``logger.info`` (47) : \"Chargement recettes depuis S3 (Parquet)\"
* ``logger.info`` (49) : \"Recettes charg√©es: {len(recipes)} lignes\"
* ``logger.error`` (52) : \"√âchec chargement recettes depuis S3: {e}\"

Chargement ratings :

* ``logger.error`` (81) : \"Module mangetamain_data_utils introuvable: {e}\"
* ``logger.info`` (88) : \"Chargement ratings depuis S3 (Parquet) - min_interactions={min_interactions}\"
* ``logger.info`` (98/100) : \"Ratings charg√©s: {len(data)} lignes (avec metadata)\" ou \"Ratings charg√©s: {len(result)} lignes\"
* ``logger.error`` (103) : \"√âchec chargement ratings depuis S3: {e}\"

**R√©partition par niveau:**

* INFO : 7 √©v√©nements (3 d√©marrage + 4 chargement donn√©es)
* WARNING : 4 √©v√©nements (CSS, S3, analyses)
* ERROR : 10 √©v√©nements (6 analyses + 4 chargement donn√©es)

S√©curit√©
^^^^^^^^

* Credentials S3 dans fichier gitignore (``96_keys/``)
* Secrets GitHub chiffr√©s
* Pas de tokens en clair dans le code
* Validation des inputs utilisateurs

Tests et Qualit√©
----------------

Tests Unitaires
^^^^^^^^^^^^^^^

* **Framework** : pytest 8.5.0
* **Nombre** : 118 tests
* **R√©sultat** : 118 tests passent
* **Organisation** : ``tests/unit/`` + ``50_test/``

Coverage
^^^^^^^^

* **Objectif** : >= 90%
* **Atteint** : 93%
* **Outil** : pytest-cov
* **Rapport** : HTML avec lignes manquantes

M√©triques par Module
^^^^^^^^^^^^^^^^^^^^

=========================== ========= ======
Module                      Coverage  Tests
=========================== ========= ======
utils/colors.py             100%      10
utils/chart_theme.py        100%      10
visualization/trendlines.py 100%      8
visualization/ratings.py    90-100%   5-14
data/cached_loaders.py      78%       3
=========================== ========= ======

Commentaires
^^^^^^^^^^^^

* Documentation inline des sections complexes
* Explication des algorithmes
* R√©f√©rences aux sources de donn√©es
* Notes sur les optimisations

Docstrings
^^^^^^^^^^

* **Format** : Google Style
* **Couverture** : Toutes fonctions/classes/modules
* **Validation** : pydocstyle dans CI
* **Exemple** :

.. code-block:: python

   def calculate_seasonal_patterns(df: pd.DataFrame) -> pd.DataFrame:
       """Calcule les patterns saisonniers des recettes.

       Analyse la distribution mensuelle des recettes et identifie
       les pics d'activit√© saisonniers.

       Args:
           df: DataFrame avec colonnes 'date' et 'recipe_id'

       Returns:
           DataFrame avec patterns saisonniers agr√©g√©s par mois

       Raises:
           ValueError: Si colonnes requises manquantes
       """
       pass

Documentation Sphinx
^^^^^^^^^^^^^^^^^^^^

* G√©n√©ration automatique depuis docstrings
* Theme Read the Docs professionnel
* API documentation compl√®te
* Guides utilisateur (installation, usage, architecture)

CI/CD
-----

Pipeline CI
^^^^^^^^^^^

V√©rifications automatiques √† chaque push :

1. **PEP8** : flake8 avec config ``.flake8``
2. **Docstrings** : pydocstyle (convention Google)
3. **Tests** : pytest avec coverage >= 90%
4. **Quality** : black, mypy (optionnel)

Ex√©cution Automatique
^^^^^^^^^^^^^^^^^^^^^

* Sur **push** vers branche de d√©veloppement
* Sur **Pull Request** vers main
* Sur **merge** vers main
* **Bloque le merge** si tests √©chouent

CD PREPROD
^^^^^^^^^^

D√©ploiement automatique sur https://mangetamain.lafrance.io/

* D√©clench√© apr√®s succ√®s du CI
* Runner self-hosted (VM dataia)
* Health checks automatiques
* Notifications Discord

CD PRODUCTION
^^^^^^^^^^^^^

D√©ploiement manuel sur https://backtothefuturekitchen.lafrance.io/

* Confirmation obligatoire (taper "DEPLOY")
* Backup automatique avant d√©ploiement
* Rollback document√© si √©chec
* Notifications Discord avec d√©tails

Alerting
^^^^^^^^

Notifications Discord temps r√©el :

* D√©marrage d√©ploiement
* Succ√®s/√©chec avec d√©tails
* Instructions rollback si √©chec
* Historique complet des d√©ploiements

Points Bonus
------------

Base de Donn√©es
^^^^^^^^^^^^^^^

DuckDB - Base OLAP columnar :

* 10-100x plus rapide que SQLite
* Zero-copy sur Parquet
* 581 MB, 7 tables
* 178K recettes, 1.1M+ interactions

Runner Self-Hosted
^^^^^^^^^^^^^^^^^^

Innovation : D√©ploiement sans VPN

* Runner GitHub sur VM dataia
* D√©ploiement en 30 secondes
* Gain : 10 minutes manuelles ‚Üí 30 secondes auto

Architecture PREPROD/PROD
^^^^^^^^^^^^^^^^^^^^^^^^^

Isolation compl√®te :

* Bases de donn√©es distinctes
* Logs s√©par√©s (debug PREPROD, errors PROD)
* Variables d'environnement diff√©renci√©es
* Ports distincts (8500 vs 8501)

R√©sum√© Standards
----------------

============================== ========= ===================
Standard                       Statut    D√©tails
============================== ========= ===================
Structure projet               ‚úÖ        Packages, modules
Environnement Python           ‚úÖ        uv + pyproject.toml
Git + GitHub                   ‚úÖ        Commits r√©guliers
README.md                      ‚úÖ        Complet
Streamlit                      ‚úÖ        UX interactive
POO                            ‚úÖ        DataLoader + hi√©rarchie exceptions
Type Hinting                   ‚úÖ        Complet
PEP8                           ‚úÖ        100% compliance
Exceptions personnalis√©es      ‚úÖ        Hi√©rarchie 6 classes
Logger                         ‚úÖ        Loguru complet
S√©curit√©                       ‚úÖ        Secrets prot√©g√©s
Tests unitaires                ‚úÖ        118 tests
Coverage >= 90%                ‚úÖ        93% atteint
Commentaires                   ‚úÖ        Sections complexes
Docstrings                     ‚úÖ        Google Style
Documentation Sphinx           ‚úÖ        Auto-g√©n√©r√©e
Pipeline CI                    ‚úÖ        PEP8 + tests + cov
Ex√©cution auto                 ‚úÖ        Push + PR + merge
CD (bonus)                     ‚úÖ        PREPROD + PROD
============================== ========= ===================
