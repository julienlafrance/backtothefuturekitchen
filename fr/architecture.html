

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Architecture Technique &mdash; Documentation Mangetamain Analytics 2.0.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d93b9cb1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=e6b791cb"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Stockage S3 Garage" href="s3.html" />
    <link rel="prev" title="Modules Infrastructure" href="modules/infrastructure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Mangetamain Analytics
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Choose your language / Choisissez votre langue</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../en/index.html">Mangetamain Analytics Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../en/index.html#deployed-environments">Deployed Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../en/index.html#dataset">Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../en/index.html#project-metrics">Project Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../en/index.html#navigation">Navigation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../en/projet.html">The Project</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/projet.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/projet.html#development-process">Development Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/projet.html#eda-application-mapping">EDA → Application Mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/projet.html#technical-stack">Technical Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/projet.html#environments">Environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/projet.html#applied-standards">Applied Standards</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#minute-installation">2-Minute Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#essential-commands">Essential Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#cheat-sheet">Cheat Sheet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#quick-troubleshooting">Quick Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#typical-workflow">Typical Workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#key-metrics">Key Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/quickstart.html#resources">Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/installation.html">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#local-installation">Local Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#installation-with-docker">Installation with Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#tests">Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#main-dependencies">Main Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#installation-verification">Installation Verification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/installation.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/application.html">Streamlit Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/application.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/application.html#structure">Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/application.html#the-4-analyses">The 4 Analyses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/application.html#data-loading">Data Loading</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/application.html#navigation">Navigation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/application.html#performance">Performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/usage.html">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/usage.html#application-architecture">Application Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/usage.html#available-analysis-modules">Available Analysis Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/usage.html#application-navigation">Application Navigation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/usage.html#customization-and-api">Customization and API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/modules/index.html">Code Documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/index.html#organization">Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/index.html#available-modules">Available Modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/index.html#conventions">Conventions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/modules/utils.html">Module utils</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/utils.html#utils-color-theme">utils.color_theme</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/utils.html#utils-chart-theme">utils.chart_theme</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/modules/visualization.html">Module visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-analyse-trendlines-v2">visualization.analyse_trendlines_v2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-analyse-seasonality">visualization.analyse_seasonality</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-analyse-weekend">visualization.analyse_weekend</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-analyse-ratings">visualization.analyse_ratings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-analyse-ratings-simple">visualization.analyse_ratings_simple</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-analyse-trendlines">visualization.analyse_trendlines</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-custom-charts">visualization.custom_charts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/visualization.html#visualization-plotly-config">visualization.plotly_config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/modules/data.html">Module data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/data.html#data-loaders">data.loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/data.html#data-cached-loaders">data.cached_loaders</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/modules/exceptions.html">Module exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/exceptions.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/exceptions.html#dataloaderror-class">DataLoadError Class</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/exceptions.html#other-exceptions">Other Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/exceptions.html#tests">Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/modules/infrastructure.html">Infrastructure Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/infrastructure.html#configuration-and-logging">Configuration and Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/infrastructure.html#database-management">Database Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/infrastructure.html#data-exploration-utilities">Data Exploration Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/infrastructure.html#infrastructure-tests">Infrastructure Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/modules/infrastructure.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/architecture.html">Technical Architecture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#deployment-infrastructure">Deployment Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#technical-stack">Technical Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#project-structure">Project Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#ci-cd-pipeline">CI/CD Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#environments">Environments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#database">Database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#tests-and-quality">Tests and Quality</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#logging">Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/architecture.html#security">Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/s3.html">Garage S3 Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#credentials-configuration">Credentials Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#aws-cli-usage">AWS CLI Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#python-boto3-usage">Python boto3 Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#duckdb-usage">DuckDB Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#polars-usage">Polars Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#performance-tests">Performance Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#bucket-structure">Bucket Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#infrastructure-tests">Infrastructure Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#performance-benchmarks">Performance Benchmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/s3.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/cicd.html">CI/CD Pipeline</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#infrastructure">Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#pipeline-architecture">Pipeline Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#github-actions-workflows">GitHub Actions Workflows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#practical-commands">Practical Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#self-hosted-runner">Self-Hosted Runner</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#discord-notifications">Discord Notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#required-configuration">Required Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#metrics">Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#concrete-workflow-examples">Concrete Workflow Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/cicd.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/tests.html">Tests and Coverage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#current-status">Current Status</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#quick-commands">Quick Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#detailed-coverage">Detailed Coverage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#id1">Infrastructure Tests (50_test)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#test-strategy">Test Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#test-patterns">Test Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#useful-pytest-commands">Useful Pytest Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#historical-progress">Historical Progress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/tests.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/conformite.html">Quality Standards</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/conformite.html#project-management">Project Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/conformite.html#programming">Programming</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/conformite.html#tests-and-quality">Tests and Quality</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/conformite.html#ci-cd">CI/CD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/conformite.html#advanced-technical-choices">Advanced Technical Choices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/conformite.html#standards-summary">Standards Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/faq.html">FAQ - Frequently Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#installation-and-configuration">Installation and Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#data-and-performance">Data and Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#development">Development</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#tests-and-ci-cd">Tests and CI/CD</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#docker">Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#deployment">Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#common-errors">Common Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/faq.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../en/glossaire.html">Glossary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#technical-terms">Technical Terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#project-terms">Project Terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#analytics-terms">Analytics Terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#infrastructure-terms">Infrastructure Terms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#acronyms">Acronyms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#common-commands">Common Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#key-values">Key Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="../en/glossaire.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../en/index.html#indices">Indices</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Documentation Mangetamain Analytics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#environnements-deployes">Environnements Déployés</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dataset">Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#metriques-projet">Métriques Projet</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#navigation">Navigation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="projet.html">Le Projet</a><ul>
<li class="toctree-l4"><a class="reference internal" href="projet.html#vue-d-ensemble">Vue d’ensemble</a></li>
<li class="toctree-l4"><a class="reference internal" href="projet.html#processus-de-developpement">Processus de Développement</a></li>
<li class="toctree-l4"><a class="reference internal" href="projet.html#correspondance-eda-application">Correspondance EDA → Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="projet.html#stack-technique">Stack Technique</a></li>
<li class="toctree-l4"><a class="reference internal" href="projet.html#environnements">Environnements</a></li>
<li class="toctree-l4"><a class="reference internal" href="projet.html#standards-appliques">Standards Appliqués</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html">Guide Démarrage Rapide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#installation-en-2-minutes">Installation en 2 Minutes</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#commandes-essentielles">Commandes Essentielles</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#cheat-sheet">Cheat Sheet</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#troubleshooting-rapide">Troubleshooting Rapide</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#flux-de-travail-typique">Flux de Travail Typique</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#metriques-cles">Métriques Clés</a></li>
<li class="toctree-l4"><a class="reference internal" href="quickstart.html#ressources">Ressources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="installation.html#prerequis">Prérequis</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#installation-locale">Installation Locale</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#installation-avec-docker">Installation avec Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#tests">Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#dependances-principales">Dépendances Principales</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#verification-de-l-installation">Vérification de l’Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#ressources-supplementaires">Ressources Supplémentaires</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="application.html">Application Streamlit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="application.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="application.html#structure">Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="application.html#les-4-analyses">Les 4 Analyses</a></li>
<li class="toctree-l4"><a class="reference internal" href="application.html#chargement-des-donnees">Chargement des Données</a></li>
<li class="toctree-l4"><a class="reference internal" href="application.html#navigation">Navigation</a></li>
<li class="toctree-l4"><a class="reference internal" href="application.html#performance">Performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">Utilisation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="usage.html#architecture-de-l-application">Architecture de l’Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="usage.html#modules-d-analyse-disponibles">Modules d’Analyse Disponibles</a></li>
<li class="toctree-l4"><a class="reference internal" href="usage.html#navigation-dans-l-application">Navigation dans l’Application</a></li>
<li class="toctree-l4"><a class="reference internal" href="usage.html#personnalisation-et-api">Personnalisation et API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules/index.html">Documentation Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules/index.html#organisation">Organisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/index.html#modules-disponibles">Modules Disponibles</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/index.html#conventions">Conventions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules/utils.html">Module utils</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules/utils.html#utils-color-theme">utils.color_theme</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/utils.html#utils-chart-theme">utils.chart_theme</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules/visualization.html">Module visualization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-analyse-trendlines-v2">visualization.analyse_trendlines_v2</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-analyse-seasonality">visualization.analyse_seasonality</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-analyse-weekend">visualization.analyse_weekend</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-analyse-ratings">visualization.analyse_ratings</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-analyse-ratings-simple">visualization.analyse_ratings_simple</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-analyse-trendlines">visualization.analyse_trendlines</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-custom-charts">visualization.custom_charts</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/visualization.html#visualization-plotly-config">visualization.plotly_config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules/data.html">Module data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules/data.html#data-loaders">data.loaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/data.html#data-cached-loaders">data.cached_loaders</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules/exceptions.html">Module exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules/exceptions.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/exceptions.html#classe-dataloaderror">Classe DataLoadError</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/exceptions.html#autres-exceptions">Autres Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/exceptions.html#tests">Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="modules/infrastructure.html">Modules Infrastructure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="modules/infrastructure.html#configuration-et-logging">Configuration et Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/infrastructure.html#gestion-base-de-donnees">Gestion Base de Données</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/infrastructure.html#utilitaires-exploration-donnees">Utilitaires Exploration Données</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/infrastructure.html#tests-infrastructure">Tests Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="modules/infrastructure.html#voir-also">Voir Also</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Architecture Technique</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#infrastructure-deploiement">Infrastructure Déploiement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stack-technique">Stack Technique</a></li>
<li class="toctree-l4"><a class="reference internal" href="#structure-du-projet">Structure du Projet</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ci-cd-pipeline">CI/CD Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environnements">Environnements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#base-de-donnees">Base de Données</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tests-et-qualite">Tests et Qualité</a></li>
<li class="toctree-l4"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#securite">Sécurité</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="s3.html">Stockage S3 Garage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="s3.html#vue-d-ensemble">Vue d’ensemble</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#configuration-credentials">Configuration Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#utilisation-aws-cli">Utilisation AWS CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#utilisation-python-boto3">Utilisation Python boto3</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#utilisation-duckdb">Utilisation DuckDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#utilisation-polars">Utilisation Polars</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#tests-performance">Tests Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#structure-bucket">Structure Bucket</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#tests-infrastructure">Tests Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#depannage">Dépannage</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#bonnes-pratiques">Bonnes Pratiques</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#benchmarks-performance">Benchmarks Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="s3.html#voir-aussi">Voir Aussi</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cicd.html">Pipeline CI/CD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#infrastructure">Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#architecture-pipeline">Architecture Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#workflows-github-actions">Workflows GitHub Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#commandes-pratiques">Commandes Pratiques</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#runner-self-hosted">Runner Self-Hosted</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#notifications-discord">Notifications Discord</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#depannage">Dépannage</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#configuration-requise">Configuration Requise</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#metriques">Métriques</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#exemples-workflows-concrets">Exemples Workflows Concrets</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="cicd.html#voir-aussi">Voir Aussi</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tests.html">Tests et Coverage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tests.html#etat-actuel">État Actuel</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#commandes-rapides">Commandes Rapides</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#coverage-detaille">Coverage Détaillé</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#id1">Tests Infrastructure (50_test)</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#strategie-de-test">Stratégie de Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#patterns-de-test">Patterns de Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#resolution-de-problemes">Résolution de Problèmes</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#commandes-pytest-utiles">Commandes Pytest Utiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#bonnes-pratiques">Bonnes Pratiques</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#progression-historique">Progression Historique</a></li>
<li class="toctree-l4"><a class="reference internal" href="tests.html#voir-aussi">Voir Aussi</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="conformite.html">Standards Qualité</a><ul>
<li class="toctree-l4"><a class="reference internal" href="conformite.html#gestion-de-projet">Gestion de Projet</a></li>
<li class="toctree-l4"><a class="reference internal" href="conformite.html#programmation">Programmation</a></li>
<li class="toctree-l4"><a class="reference internal" href="conformite.html#tests-et-qualite">Tests et Qualité</a></li>
<li class="toctree-l4"><a class="reference internal" href="conformite.html#ci-cd">CI/CD</a></li>
<li class="toctree-l4"><a class="reference internal" href="conformite.html#choix-techniques-avances">Choix Techniques Avancés</a></li>
<li class="toctree-l4"><a class="reference internal" href="conformite.html#resume-standards">Résumé Standards</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="faq.html">FAQ - Questions Fréquentes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="faq.html#installation-et-configuration">Installation et Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#donnees-et-performance">Données et Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#developpement">Développement</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#tests-et-ci-cd">Tests et CI/CD</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#docker">Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#deploiement">Déploiement</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#erreurs-courantes">Erreurs Courantes</a></li>
<li class="toctree-l4"><a class="reference internal" href="faq.html#ressources-supplementaires">Ressources Supplémentaires</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="glossaire.html">Glossaire</a><ul>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#termes-techniques">Termes Techniques</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#termes-projet">Termes Projet</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#termes-analytics">Termes Analytics</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#termes-infrastructure">Termes Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#acronymes">Acronymes</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#commandes-courantes">Commandes Courantes</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#valeurs-cles">Valeurs Clés</a></li>
<li class="toctree-l4"><a class="reference internal" href="glossaire.html#voir-aussi">Voir Aussi</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices">Indices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mangetamain Analytics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Documentation Mangetamain Analytics</a></li>
      <li class="breadcrumb-item active">Architecture Technique</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/fr/architecture.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="architecture-technique">
<h1>Architecture Technique<a class="headerlink" href="#architecture-technique" title="Lien vers cette rubrique"></a></h1>
<p>Vue d’ensemble de l’architecture technique du projet.</p>
<p><strong>Termes et acronymes</strong>: voir <a class="reference internal" href="glossaire.html"><span class="doc">Glossaire</span></a></p>
<section id="infrastructure-deploiement">
<h2>Infrastructure Déploiement<a class="headerlink" href="#infrastructure-deploiement" title="Lien vers cette rubrique"></a></h2>
<section id="serveur-hote-ix-ia">
<h3>Serveur Hôte IX-IA<a class="headerlink" href="#serveur-hote-ix-ia" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>Nom</strong> : IX-IA</p></li>
<li><p><strong>OS</strong> : Ubuntu 24.04.3 LTS</p></li>
<li><p><strong>CPU</strong> : 8 cores (Intel Core i7-11700K, 16 threads)</p></li>
<li><p><strong>RAM</strong> : 125 GB</p></li>
<li><p><strong>Disques</strong> : 915 GB (/), 1.7 TB (/home), 7.3 TB (/stock)</p></li>
<li><p><strong>Réseau</strong> : Double IP (LAN 192.168.0.202 + DMZ 192.168.80.202)</p></li>
<li><p><strong>Virtualisation</strong> : KVM/QEMU via virsh</p></li>
</ul>
</section>
<section id="vm-autonome-dataia25-vm-v1-virsh-kvm">
<h3>VM Autonome dataia25-vm-v1 (virsh/KVM)<a class="headerlink" href="#vm-autonome-dataia25-vm-v1-virsh-kvm" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>Technologie</strong> : Machine virtuelle créée avec virsh (KVM/QEMU)</p></li>
<li><p><strong>Nom</strong> : dataia25-vm-v1</p></li>
<li><p><strong>Hébergement</strong> : Serveur physique IX-IA (DMZ VLAN 80)</p></li>
<li><p><strong>OS</strong> : Ubuntu (Debian-based)</p></li>
<li><p><strong>Ressources</strong> : 8 vCPUs (max 12), RAM 32 GB, Disk qcow2 avec virtio</p></li>
<li><p><strong>Réseau</strong> : IP DMZ 192.168.80.210/24 (bridge br80 via TAP vnet0)</p></li>
<li><p><strong>Partages</strong> : 2x 9p filesystems (kaggle_data, temp)</p></li>
<li><p><strong>Accès</strong> : SSH depuis OpenVPN (accès DMZ uniquement)</p></li>
</ul>
</section>
<section id="containerisation-docker-sur-vm">
<h3>Containerisation Docker sur VM<a class="headerlink" href="#containerisation-docker-sur-vm" title="Lien vers cette rubrique"></a></h3>
<p>Tous les environnements applicatifs tournent dans des <strong>containers Docker isolés</strong> sur la VM dataia25-vm-v1 :</p>
<p><strong>Container PREPROD (mange_preprod)</strong> :</p>
<ul class="simple">
<li><p>Nom : mange_preprod</p></li>
<li><p>Image : python:3.13.3-slim</p></li>
<li><p>Port : 8500 (accessible via 192.168.80.210:8500)</p></li>
<li><p>Réseau : mangetamain-preprod-network (172.18.0.0/16)</p></li>
<li><p>Stockage : S3 (s3fast.lafrance.io)</p></li>
<li><p>Logs : 10_preprod/logs/</p></li>
<li><p>Variables env : APP_ENV=preprod</p></li>
<li><p>URL externe : <a class="reference external" href="https://mangetamain.lafrance.io/">https://mangetamain.lafrance.io/</a> (via reverse proxy)</p></li>
</ul>
<p><strong>Container PROD (mange_prod)</strong> :</p>
<ul class="simple">
<li><p>Nom : mange_prod</p></li>
<li><p>Image : python:3.13.3-slim</p></li>
<li><p>Port : 8501 (accessible via 192.168.80.210:8501)</p></li>
<li><p>Réseau : mangetamain-prod-network (172.19.0.0/16)</p></li>
<li><p>Stockage : S3 (s3fast.lafrance.io)</p></li>
<li><p>Logs : 20_prod/logs/</p></li>
<li><p>Variables env : APP_ENV=prod</p></li>
<li><p>URL externe : <a class="reference external" href="https://backtothefuturekitchen.lafrance.io/">https://backtothefuturekitchen.lafrance.io/</a> (via reverse proxy)</p></li>
</ul>
<p><strong>Orchestration</strong> : Docker Compose (30_docker/)</p>
<p><strong>Isolation complète</strong> :</p>
<ul class="simple">
<li><p>Stockage S3 partagé (données communes)</p></li>
<li><p>Logs séparés par environnement</p></li>
<li><p>Variables d’environnement différenciées</p></li>
<li><p>Réseaux Docker isolés (172.18 vs 172.19)</p></li>
<li><p>Pas de partage de volumes entre containers</p></li>
</ul>
</section>
<section id="runner-github-self-hosted">
<h3>Runner GitHub Self-Hosted<a class="headerlink" href="#runner-github-self-hosted" title="Lien vers cette rubrique"></a></h3>
<p>Le <strong>runner GitHub self-hosted</strong> installé sur la VM dataia orchestre les déploiements :</p>
<ul class="simple">
<li><p>Écoute les événements GitHub (push, workflow_dispatch)</p></li>
<li><p>Exécute les workflows CI/CD (.github/workflows/)</p></li>
<li><p>Accès direct aux containers pour déploiement</p></li>
<li><p>Exécute git reset + docker-compose restart</p></li>
<li><p><strong>Avantage</strong> : Déploiement automatique sans VPN manuel</p></li>
</ul>
<p><strong>Voir</strong> : <a class="reference internal" href="cicd.html"><span class="doc">Pipeline CI/CD</span></a> pour détails complets du pipeline.</p>
</section>
<section id="infrastructure-s3-garage">
<h3>Infrastructure S3 (Garage)<a class="headerlink" href="#infrastructure-s3-garage" title="Lien vers cette rubrique"></a></h3>
<p>Le stockage S3-compatible est assuré par <strong>Garage</strong> hébergé sur le serveur hôte IX-IA :</p>
<ul class="simple">
<li><p><strong>Container</strong> : garage-fast (dxflrs/garage:v2.1.0)</p></li>
<li><p><strong>Mode réseau</strong> : host (accessible directement sur IP hôte)</p></li>
<li><p><strong>Ports</strong> : 3910 (API S3), 3913 (Web S3)</p></li>
<li><p><strong>Stockage</strong> : /s3fast (~646 MB utilisés actuellement)</p></li>
</ul>
<p><strong>Endpoints disponibles</strong> :</p>
<ul class="simple">
<li><p><strong>HTTP</strong> : <a class="reference external" href="http://s3fast.lafrance.io">http://s3fast.lafrance.io</a> (port 3910) - <strong>Privilégié dans le code</strong></p></li>
<li><p><strong>HTTPS</strong> : <a class="reference external" href="https://s3fast.lafrance.io">https://s3fast.lafrance.io</a> (port 443, via reverse proxy)</p></li>
<li><p><strong>Endpoint interne VM</strong> : <a class="reference external" href="http://192.168.80.202:3910">http://192.168.80.202:3910</a> (accès direct optimisé)</p></li>
</ul>
<p><strong>Choix HTTP</strong> : Le code utilise HTTP pour des raisons de performance (pas de surcharge TLS/SSL) car la communication reste dans le réseau DMZ sécurisé (192.168.80.0/24).</p>
<p><strong>Configuration accès VM optimisé</strong> :</p>
<p>L’accès depuis la VM vers le S3 bypass le reverse proxy pour de meilleures performances :</p>
<ul class="simple">
<li><p>Entrée /etc/hosts sur VM : <code class="docutils literal notranslate"><span class="pre">192.168.80.202</span>&#160; <span class="pre">s3fast.lafrance.io</span></code></p></li>
<li><p>Accès direct via bridge br80 (même réseau DMZ)</p></li>
<li><p>Gain de performance significatif (pas de double passage réseau)</p></li>
</ul>
</section>
<section id="architecture-reseau-et-securite">
<h3>Architecture Réseau et Sécurité<a class="headerlink" href="#architecture-reseau-et-securite" title="Lien vers cette rubrique"></a></h3>
<p><strong>Objectifs de l’architecture</strong> :</p>
<ul class="simple">
<li><p><strong>Sécurité</strong> : Isolation DMZ (VLAN 80) avec hôte IX-IA à double IP</p></li>
<li><p><strong>Performance</strong> : Route directe VM → S3 via bridge br80 (bypass proxy)</p></li>
</ul>
<p><strong>Configuration DMZ (VLAN 80)</strong> :</p>
<ul class="simple">
<li><p>Interface : enp4s0.80 (VLAN tagué 802.1Q)</p></li>
<li><p>Bridge : br80 (192.168.80.202/24) sur hôte IX-IA</p></li>
<li><p>VM connectée via TAP vnet0 sur bridge br80</p></li>
<li><p>Réseau DMZ : 192.168.80.0/24</p></li>
<li><p>Gateway DMZ : 192.168.80.1</p></li>
</ul>
<p><strong>Schéma d’architecture réseau complet</strong> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                       Internet (IP publique)
                              │
                              │
           ┌──────────────────┴──────────────────┐
           │                                     │
           │      Routeur/Firewall Externe       │
           │                                     │
           └─────┬────────────────────────┬──────┘
                 │                        │
                 │ (OpenVPN)              │ (HTTPS/TLS)
                 │                        │
   ┌─────────────▼─────────────┐         │
   │  OpenVPN (192.168.0.254)  │         │
   │  Accès: DMZ UNIQUEMENT    │         │
   │  (192.168.80.0/24)        │         │
   └───────────────────────────┘         │
                                         │
                           ┌─────────────▼──────────────┐
                           │  Gateway (192.168.0.254)   │
                           └─────────────┬──────────────┘
                                         │
                       Réseau LAN (192.168.0.0/24)
                                         │
                           ┌─────────────▼─────────────────────┐
                           │ Reverse Proxy (192.168.0.201)     │
                           │  - HTTPS/TLS termination          │
                           │  - mangetamain.lafrance.io        │
                           │  - backtothefuturekitchen.lafrance.io │
                           │  - s3fast.lafrance.io             │
                           └─────┬──────────────────┬──────────┘
                                 │                  │
                                 │                  │
╔════════════════════════════════▼══════════════════▼══════════════════════╗
║                                                                          ║
║              Serveur Physique IX-IA (192.168.0.202)                     ║
║              Ubuntu 24.04.3 LTS - i7-11700K (8c/16t) - 125GB RAM        ║
║                                                                          ║
║  ┌─────────────────────────────────────────────────────────────────┐    ║
║  │ Interface réseau:                                               │    ║
║  │  • IP LAN: 192.168.0.202                                        │    ║
║  │  • IP DMZ: 192.168.80.202 (sur bridge br80)                     │    ║
║  │  • VLAN 80 tagué sur enp4s0.80                                  │    ║
║  └─────────────────────────────────────────────────────────────────┘    ║
║                                                                          ║
║  ┌──────────────────────────────┐  ┌──────────────────────────────┐    ║
║  │   Docker Garage S3           │  │   Bridge br80 (DMZ VLAN 80)  │    ║
║  │   garage-fast (mode: host)   │  │   192.168.80.202/24          │    ║
║  │                              │  │                              │    ║
║  │   • Port 3910 (API S3)       │  │   ┌──────────────────────┐   │    ║
║  │   • Port 3913 (Web S3)       │  │   │   TAP vnet0          │   │    ║
║  │   • /s3fast (~646MB)         │  │   │   (interface VM)     │   │    ║
║  │                              │  │   └──────────┬───────────┘   │    ║
║  │   Accessible via:            │  │              │               │    ║
║  │   • LAN: 192.168.0.202:3910  │◄─┼──────────────┼──────────┐    │    ║
║  │   • DMZ: 192.168.80.202:3910 │◄─┼──────────────┘          │    │    ║
║  └──────────────────────────────┘  └───────────────────────────┘  │    ║
║                                          │                         │    ║
║  ┌───────────────────────────────────────▼──────────────────────┐ │    ║
║  │                                                               │ │    ║
║  │        VM dataia25-vm-v1 (KVM/QEMU - virsh)                  │ │    ║
║  │        8 vCPUs, 32GB RAM, qcow2 virtio                       │ │    ║
║  │        192.168.80.210/24                                     │ │    ║
║  │                                                               │ │    ║
║  │   /etc/hosts: 192.168.80.202 = s3fast.lafrance.io            │ │    ║
║  │   (Accès S3 LOCAL via bridge br80 - ultra-rapide)◄───────────┘ │    ║
║  │                                                                 │    ║
║  │   ┌───────────────────────────────────────────────┐             │    ║
║  │   │  Docker Containers (sur VM)                   │             │    ║
║  │   │                                               │             │    ║
║  │   │  • mange_preprod (172.18.0.x:8500)            │◄────────────┼────╋─┐
║  │   │    → mangetamain.lafrance.io                  │             │    ║ │
║  │   │                                               │             │    ║ │ Via
║  │   │  • mange_prod (172.19.0.x:8501)               │◄────────────┼────╋─┘ reverse
║  │   │    → backtothefuturekitchen.lafrance.io       │             │    ║   proxy
║  │   │                                               │             │    ║   HTTPS
║  │   └───────────────────────────────────────────────┘             │    ║
║  │                                                                 │    ║
║  │   ┌───────────────────────────────────────────────┐             │    ║
║  │   │  GitHub Actions Runner                        │             │    ║
║  │   │  (Tunneling sortant uniquement)               │─────────────┼────╋──► Internet
║  │   └───────────────────────────────────────────────┘             │    ║
║  │                                                                 │    ║
║  └─────────────────────────────────────────────────────────────────┘    ║
║                                                                          ║
╚══════════════════════════════════════════════════════════════════════════╝

Note: La VM et le S3 sont sur la MÊME machine physique (IX-IA).
Les accès VM → S3 sont ultra-rapides (communication locale via br80).
</pre></div>
</div>
<p><strong>Flux réseau</strong> :</p>
<ul class="simple">
<li><p><strong>Flux 1 - Accès VPN</strong> : OpenVPN → DMZ uniquement (isolation sécurité)</p></li>
<li><p><strong>Flux 2 - Web PREPROD</strong> : Internet → Reverse Proxy → VM:8500 (mange_preprod)</p></li>
<li><p><strong>Flux 3 - Web PROD</strong> : Internet → Reverse Proxy → VM:8501 (mange_prod)</p></li>
<li><p><strong>Flux 4 - S3 externe</strong> : Internet → Reverse Proxy → Hôte ixia:3910 (Garage S3)</p></li>
<li><p><strong>Flux 5 - S3 interne optimisé</strong> : VM → br80 → ixia:3910 (bypass proxy, performances)</p></li>
<li><p><strong>Flux 6 - GitHub Runner</strong> : VM → Internet (tunneling GitHub sortant uniquement)</p></li>
</ul>
</section>
<section id="monitoring-et-surveillance">
<h3>Monitoring et Surveillance<a class="headerlink" href="#monitoring-et-surveillance" title="Lien vers cette rubrique"></a></h3>
<p>Surveillance externe des environnements avec <strong>UptimeRobot</strong> :</p>
<p><strong>Service</strong> : UptimeRobot (plan gratuit, 50 monitors)</p>
<p><strong>URLs surveillées</strong> :</p>
<ul class="simple">
<li><p>PREPROD : <a class="reference external" href="https://mangetamain.lafrance.io/">https://mangetamain.lafrance.io/</a> (port 8500)</p></li>
<li><p>PRODUCTION : <a class="reference external" href="https://backtothefuturekitchen.lafrance.io/">https://backtothefuturekitchen.lafrance.io/</a> (port 8501)</p></li>
</ul>
<p><strong>Configuration</strong> :</p>
<ul class="simple">
<li><p>Intervalle de vérification : toutes les 5 minutes</p></li>
<li><p>Timeout : 30 secondes</p></li>
<li><p>Protocole : HTTPS (via reverse proxy)</p></li>
</ul>
<p><strong>Détection</strong> :</p>
<ul class="simple">
<li><p>Serveur inaccessible (pas de réponse réseau)</p></li>
<li><p>Backend Streamlit down (erreur 502/503 du reverse proxy)</p></li>
<li><p>Timeouts dépassant 30 secondes</p></li>
<li><p>Erreurs HTTP (codes 4xx/5xx)</p></li>
</ul>
<p><strong>Alertes</strong> :</p>
<ul class="simple">
<li><p>Email automatique en cas de panne détectée</p></li>
<li><p>Webhook Discord pour notifications temps réel</p></li>
<li><p>Dashboard UptimeRobot avec historique uptime</p></li>
</ul>
<p><strong>Avantages monitoring externe</strong> :</p>
<ul class="simple">
<li><p>Détection fiable (externe au serveur surveillé)</p></li>
<li><p>Fréquence élevée (5 min vs anciennes checks GitHub 1h)</p></li>
<li><p>Pas de dépendance au runner self-hosted</p></li>
<li><p>Statistiques d’uptime et SLA automatiques</p></li>
</ul>
</section>
</section>
<section id="stack-technique">
<h2>Stack Technique<a class="headerlink" href="#stack-technique" title="Lien vers cette rubrique"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Catégorie</p></th>
<th class="head"><p>Technologies</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Backend</strong></p></td>
<td><p>DuckDB 1.4.0 (base OLAP columnar)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Frontend</strong></p></td>
<td><p>Streamlit 1.50.0 + Plotly 5.24.1</p></td>
</tr>
<tr class="row-even"><td><p><strong>Data Science</strong></p></td>
<td><p>Pandas 2.2.3, NumPy 2.2.6, Polars 1.19.0</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Logging</strong></p></td>
<td><p>Loguru 0.7.3 (rotation automatique)</p></td>
</tr>
<tr class="row-even"><td><p><strong>Package Manager</strong></p></td>
<td><p>uv 0.8.22 (ultrafast pip replacement)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Tests</strong></p></td>
<td><p>pytest 8.5.0, pytest-cov 6.0.0</p></td>
</tr>
<tr class="row-even"><td><p><strong>CI/CD</strong></p></td>
<td><p>GitHub Actions + self-hosted runner</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Déploiement</strong></p></td>
<td><p>Docker Compose, VM dataia (VPN)</p></td>
</tr>
<tr class="row-even"><td><p><strong>Monitoring</strong></p></td>
<td><p>UptimeRobot (surveillance externe toutes les 5 min)</p></td>
</tr>
</tbody>
</table>
<section id="details-des-technologies-cles">
<h3>Détails des Technologies Clés<a class="headerlink" href="#details-des-technologies-cles" title="Lien vers cette rubrique"></a></h3>
<p><strong>DuckDB</strong></p>
<p>Base de données OLAP columnar performante :</p>
<ul class="simple">
<li><p>10-100x plus rapide que SQLite pour analyses</p></li>
<li><p>Zero-copy sur fichiers Parquet</p></li>
<li><p>SQL standard complet</p></li>
<li><p>Intégration native Pandas/Polars</p></li>
<li><p>Fichier unique 581 MB (7 tables)</p></li>
</ul>
<p><strong>Streamlit</strong></p>
<p>Framework web Python interactif :</p>
<ul class="simple">
<li><p>Widgets réactifs (sliders, selectbox, etc.)</p></li>
<li><p>Cache intégré (&#64;st.cache_data)</p></li>
<li><p>Rechargement automatique du code</p></li>
<li><p>Déploiement simple (Docker)</p></li>
</ul>
<p><strong>Plotly</strong></p>
<p>Bibliothèque de visualisations interactives :</p>
<ul class="simple">
<li><p>Graphiques interactifs (zoom, pan, hover)</p></li>
<li><p>Subplots synchronisés</p></li>
<li><p>Thème personnalisable</p></li>
<li><p>Export PNG/SVG</p></li>
</ul>
</section>
<section id="outils-de-developpement">
<h3>Outils de Développement<a class="headerlink" href="#outils-de-developpement" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>uv 0.8.22</strong> : Gestionnaire de paquets moderne</p></li>
<li><p><strong>pytest 8.5.0</strong> : Tests unitaires</p></li>
<li><p><strong>pytest-cov 6.0.0</strong> : Coverage des tests</p></li>
<li><p><strong>flake8</strong> : Vérification PEP8</p></li>
<li><p><strong>black</strong> : Formatage automatique du code</p></li>
<li><p><strong>pydocstyle</strong> : Validation des docstrings</p></li>
</ul>
</section>
</section>
<section id="structure-du-projet">
<h2>Structure du Projet<a class="headerlink" href="#structure-du-projet" title="Lien vers cette rubrique"></a></h2>
<section id="organisation-des-repertoires">
<h3>Organisation des Répertoires<a class="headerlink" href="#organisation-des-repertoires" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/mangetamain/
├── 00_eda/                    # Notebooks Jupyter d&#39;exploration
├── 10_preprod/                # Application PREPROD (source de vérité)
│   ├── src/
│   │   └── mangetamain_analytics/
│   │       ├── main.py
│   │       ├── utils/
│   │       ├── visualization/
│   │       ├── data/
│   │       └── assets/
│   ├── tests/
│   └── pyproject.toml
├── 20_prod/                   # Application PRODUCTION (artefact)
├── 30_docker/                 # Docker Compose
├── 40_utils/                  # Utilitaires data (mangetamain_data_utils)
├── 50_test/                   # Tests infrastructure S3/DuckDB
├── 70_scripts/                # Scripts shell (deploy, CI checks)
├── 90_doc/                    # Documentation (ce répertoire)
├── 96_keys/                   # Credentials S3 (ignoré par git)
└── .github/workflows/         # CI/CD
</pre></div>
</div>
</section>
<section id="modules-applicatifs">
<h3>Modules Applicatifs<a class="headerlink" href="#modules-applicatifs" title="Lien vers cette rubrique"></a></h3>
<p><strong>Module utils</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">color_theme.py</span></code> : Classe ColorTheme POO pour la charte graphique « Back to the Kitchen »</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chart_theme.py</span></code> : Fonctions d’application du thème Plotly</p></li>
</ul>
<p><strong>Module visualization</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">analyse_trendlines_v2.py</span></code> : Analyse des tendances temporelles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">analyse_seasonality.py</span></code> : Analyse des patterns saisonniers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">analyse_weekend.py</span></code> : Analyse de l’effet jour/weekend</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">analyse_ratings.py</span></code> : Analyse des notes utilisateurs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_charts.py</span></code> : Graphiques réutilisables</p></li>
</ul>
<p><strong>Module data</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cached_loaders.py</span></code> : Chargement des données avec cache Streamlit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loaders.py</span></code> : Classe DataLoader pour chargement données avec gestion d’erreurs</p></li>
</ul>
<p><strong>Module exceptions</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exceptions.py</span></code> : Hiérarchie d’exceptions personnalisées (5 classes)</p></li>
</ul>
</section>
</section>
<section id="ci-cd-pipeline">
<h2>CI/CD Pipeline<a class="headerlink" href="#ci-cd-pipeline" title="Lien vers cette rubrique"></a></h2>
<section id="architecture-sequentielle">
<h3>Architecture Séquentielle<a class="headerlink" href="#architecture-sequentielle" title="Lien vers cette rubrique"></a></h3>
<p>Le pipeline CI/CD est organisé en 3 phases :</p>
<ol class="arabic simple">
<li><p><strong>CI - Quality &amp; Tests</strong> (automatique sur push)</p>
<ul class="simple">
<li><p>Vérification PEP8 (flake8)</p></li>
<li><p>Validation docstrings (pydocstyle)</p></li>
<li><p>Tests unitaires (pytest)</p></li>
<li><p>Coverage &gt;= 90%</p></li>
</ul>
</li>
<li><p><strong>CD Preprod</strong> (automatique après CI réussi)</p>
<ul class="simple">
<li><p>Déploiement sur <a class="reference external" href="https://mangetamain.lafrance.io/">https://mangetamain.lafrance.io/</a></p></li>
<li><p>Redémarrage container Docker</p></li>
<li><p>Health checks automatiques</p></li>
</ul>
</li>
<li><p><strong>CD Production</strong> (manuel avec confirmation)</p>
<ul class="simple">
<li><p>Backup automatique</p></li>
<li><p>Déploiement sur <a class="reference external" href="https://backtothefuturekitchen.lafrance.io/">https://backtothefuturekitchen.lafrance.io/</a></p></li>
<li><p>Health checks avec retry</p></li>
</ul>
</li>
</ol>
</section>
<section id="workflows-github-actions">
<h3>Workflows GitHub Actions<a class="headerlink" href="#workflows-github-actions" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.github/workflows/ci.yml</span></code> : Pipeline CI complet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.github/workflows/cd-preprod.yml</span></code> : Déploiement PREPROD</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.github/workflows/cd-prod.yml</span></code> : Déploiement PRODUCTION</p></li>
</ul>
</section>
<section id="runner-self-hosted">
<h3>Runner Self-Hosted<a class="headerlink" href="#runner-self-hosted" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Localisation : VM dataia (réseau VPN)</p></li>
<li><p>Avantage : Déploiement sans connexion VPN manuelle</p></li>
<li><p>Notifications : Discord webhooks en temps réel</p></li>
</ul>
</section>
</section>
<section id="environnements">
<h2>Environnements<a class="headerlink" href="#environnements" title="Lien vers cette rubrique"></a></h2>
<section id="preprod">
<h3>PREPROD<a class="headerlink" href="#preprod" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>URL</strong> : <a class="reference external" href="https://mangetamain.lafrance.io/">https://mangetamain.lafrance.io/</a></p></li>
<li><p><strong>Port</strong> : 8500</p></li>
<li><p><strong>Usage</strong> : Développement et tests</p></li>
<li><p><strong>Déploiement</strong> : Automatique sur push vers main</p></li>
</ul>
</section>
<section id="production">
<h3>PRODUCTION<a class="headerlink" href="#production" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>URL</strong> : <a class="reference external" href="https://backtothefuturekitchen.lafrance.io/">https://backtothefuturekitchen.lafrance.io/</a></p></li>
<li><p><strong>Port</strong> : 8501</p></li>
<li><p><strong>Usage</strong> : Application stable</p></li>
<li><p><strong>Déploiement</strong> : Manuel avec confirmation</p></li>
</ul>
</section>
<section id="differences">
<h3>Différences<a class="headerlink" href="#differences" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Bases de données distinctes</p></li>
<li><p>Logs séparés</p></li>
<li><p>Variables d’environnement différenciées</p></li>
<li><p>Badges visuels auto-détectés</p></li>
</ul>
</section>
</section>
<section id="base-de-donnees">
<h2>Base de Données<a class="headerlink" href="#base-de-donnees" title="Lien vers cette rubrique"></a></h2>
<section id="duckdb">
<h3>DuckDB<a class="headerlink" href="#duckdb" title="Lien vers cette rubrique"></a></h3>
<p>Fichier : <code class="docutils literal notranslate"><span class="pre">mangetamain.duckdb</span></code> (581 MB)</p>
<p><strong>Tables principales :</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">recipes</span></code> : 178,265 recettes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interactions</span></code> : 1.1M+ interactions utilisateurs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">users</span></code> : 25,076 utilisateurs</p></li>
<li><p>Tables dérivées pour analyses</p></li>
</ul>
<p><strong>Avantages DuckDB :</strong></p>
<ul class="simple">
<li><p>OLAP columnar (10-100x plus rapide que SQLite)</p></li>
<li><p>Zero-copy sur fichiers Parquet</p></li>
<li><p>SQL standard complet</p></li>
<li><p>Intégration native Pandas/Polars</p></li>
</ul>
</section>
<section id="stockage-s3">
<h3>Stockage S3<a class="headerlink" href="#stockage-s3" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>Endpoint</strong> : s3fast.lafrance.io</p></li>
<li><p><strong>Bucket</strong> : mangetamain</p></li>
<li><p><strong>Credentials</strong> : Fichier 96_keys/credentials</p></li>
<li><p><strong>Performance</strong> : 500-917 MB/s</p></li>
</ul>
</section>
<section id="chargement-des-donnees">
<h3>Chargement des Données<a class="headerlink" href="#chargement-des-donnees" title="Lien vers cette rubrique"></a></h3>
<p>Les données sont chargées automatiquement depuis S3 au démarrage via le module <code class="docutils literal notranslate"><span class="pre">data.cached_loaders</span></code> avec cache Streamlit (TTL 1h).</p>
</section>
</section>
<section id="tests-et-qualite">
<h2>Tests et Qualité<a class="headerlink" href="#tests-et-qualite" title="Lien vers cette rubrique"></a></h2>
<section id="metriques">
<h3>Métriques<a class="headerlink" href="#metriques" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>Coverage</strong> : 93% (objectif 90%)</p></li>
<li><p><strong>Tests unitaires</strong> : 118 tests</p></li>
<li><p><strong>PEP8 compliance</strong> : 100%</p></li>
<li><p><strong>Docstrings</strong> : Google style</p></li>
</ul>
</section>
<section id="types-de-tests">
<h3>Types de Tests<a class="headerlink" href="#types-de-tests" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>Tests unitaires</strong> : 10_preprod/tests/unit/ (83 tests)</p></li>
<li><p><strong>Tests infrastructure</strong> : 50_test/ (35 tests S3/DuckDB/SQL)</p></li>
</ul>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.flake8</span></code> : Configuration PEP8</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.pydocstyle</span></code> : Configuration docstrings</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> : Configuration pytest et coverage</p></li>
</ul>
</section>
</section>
<section id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Lien vers cette rubrique"></a></h2>
<section id="architecture-loguru">
<h3>Architecture Loguru<a class="headerlink" href="#architecture-loguru" title="Lien vers cette rubrique"></a></h3>
<p>Le système de logging utilise <strong>Loguru 0.7.3</strong> avec séparation automatique des environnements.</p>
<p><strong>Fonctionnalités clés :</strong></p>
<ul class="simple">
<li><p>Détection automatique environnement (prod/preprod/local)</p></li>
<li><p>3 fichiers séparés : debug.log, errors.log, user_interactions.log</p></li>
<li><p>Rotation automatique (10 MB debug, 5 MB errors, 1 jour user_interactions)</p></li>
<li><p>Compression automatique (.zip)</p></li>
<li><p>Thread-safe pour Streamlit (<code class="docutils literal notranslate"><span class="pre">enqueue=True</span></code>)</p></li>
<li><p>Backtrace complet pour erreurs</p></li>
<li><p>Module EnvironmentDetector avec cache</p></li>
</ul>
</section>
<section id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Lien vers cette rubrique"></a></h3>
<p><strong>Module</strong>: <code class="docutils literal notranslate"><span class="pre">utils_logger.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">utils_logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoggerConfig</span><span class="p">,</span> <span class="n">log_user_action</span><span class="p">,</span> <span class="n">log_error</span><span class="p">,</span> <span class="n">log_performance</span>

<span class="c1"># Configuration automatique au démarrage</span>
<span class="n">log_config</span> <span class="o">=</span> <span class="n">LoggerConfig</span><span class="p">()</span>  <span class="c1"># Détecte env automatiquement</span>
<span class="n">log_config</span><span class="o">.</span><span class="n">setup_logger</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Handlers configurés</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Console</strong>: PREPROD/LOCAL (DEBUG colorisé), PROD (WARNING non colorisé)</p></li>
<li><p><strong>Debug</strong>: {env}_debug.log - Tous niveaux ≥ DEBUG (10 MB, 7j, zip)</p></li>
<li><p><strong>Errors</strong>: {env}_errors.log - ERROR et CRITICAL (5 MB, 7j preprod / 30j prod, zip, backtrace)</p></li>
<li><p><strong>User Interactions</strong>: {env}_user_interactions.log - Actions utilisateur (1 jour, 90j preprod / 30j prod, zip)</p></li>
</ol>
<p><strong>Fonctions utilitaires</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erreurs avec contexte</span>
<span class="n">log_error</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;data_loading&quot;</span><span class="p">)</span>

<span class="c1"># Actions utilisateur</span>
<span class="n">log_user_action</span><span class="p">(</span><span class="s2">&quot;filter_change&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2024&quot;</span><span class="p">},</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;anonymous&quot;</span><span class="p">)</span>

<span class="c1"># Métriques performance</span>
<span class="n">log_performance</span><span class="p">(</span><span class="s2">&quot;load_ratings&quot;</span><span class="p">,</span> <span class="mf">1.234</span><span class="p">,</span> <span class="n">records</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="detection-environnement">
<h3>Détection Environnement<a class="headerlink" href="#detection-environnement" title="Lien vers cette rubrique"></a></h3>
<p><strong>Module</strong>: <code class="docutils literal notranslate"><span class="pre">src/mangetamain_analytics/utils/environment.py</span></code></p>
<p>La détection se fait automatiquement via la classe <code class="docutils literal notranslate"><span class="pre">EnvironmentDetector</span></code> :</p>
<ol class="arabic simple">
<li><p><strong>Variable d’environnement</strong> <code class="docutils literal notranslate"><span class="pre">APP_ENV</span></code> (case-insensitive, prioritaire)</p></li>
<li><p><strong>Path automatique</strong> : détection via <code class="docutils literal notranslate"><span class="pre">10_preprod/</span></code> ou <code class="docutils literal notranslate"><span class="pre">20_prod/</span></code> dans le path</p></li>
<li><p><strong>Fallback</strong> : <code class="docutils literal notranslate"><span class="pre">LOCAL</span></code> si aucun des deux</p></li>
</ol>
<p><strong>Caractéristiques</strong> :</p>
<ul class="simple">
<li><p>Cache du résultat (performance)</p></li>
<li><p>Méthode <code class="docutils literal notranslate"><span class="pre">reset_cache()</span></code> pour tests unitaires</p></li>
<li><p>Méthode <code class="docutils literal notranslate"><span class="pre">get_name()</span></code> retournant string uppercase</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mangetamain_analytics.utils.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">EnvironmentDetector</span>

<span class="c1"># Détection automatique avec cache</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">EnvironmentDetector</span><span class="o">.</span><span class="n">detect</span><span class="p">()</span>  <span class="c1"># Returns Environment.PREPROD|PROD|LOCAL</span>

<span class="c1"># Nom environnement (string uppercase)</span>
<span class="n">env_name</span> <span class="o">=</span> <span class="n">EnvironmentDetector</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>  <span class="c1"># Returns &quot;PREPROD&quot;|&quot;PROD&quot;|&quot;LOCAL&quot;</span>

<span class="c1"># Reset cache (tests uniquement)</span>
<span class="n">EnvironmentDetector</span><span class="o">.</span><span class="n">reset_cache</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="structure-des-logs">
<h3>Structure des Logs<a class="headerlink" href="#structure-des-logs" title="Lien vers cette rubrique"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>10_preprod/logs/
├── preprod_debug.log              # Tous niveaux ≥ DEBUG
├── preprod_errors.log             # ERROR, CRITICAL (7j)
├── preprod_user_interactions.log  # Actions utilisateur (90j)
└── .gitkeep

20_prod/logs/
├── prod_debug.log                 # Tous niveaux ≥ DEBUG
├── prod_errors.log                # ERROR, CRITICAL (30j)
├── prod_user_interactions.log     # Actions utilisateur (30j)
└── .gitkeep
</pre></div>
</div>
<p><strong>Rotation :</strong></p>
<ul class="simple">
<li><p>Debug logs : 10 MB max, rétention 7 jours</p></li>
<li><p>Error logs : 5 MB max, rétention 7j (preprod) / 30j (prod)</p></li>
<li><p>User interactions : 1 jour, rétention 90j (preprod) / 30j (prod)</p></li>
<li><p>Compression automatique en .zip</p></li>
</ul>
</section>
<section id="utilisation">
<h3>Utilisation<a class="headerlink" href="#utilisation" title="Lien vers cette rubrique"></a></h3>
<p><strong>Logging basique</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>

<span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Application started&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;S3 not accessible&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to load data&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Avec fonctions utilitaires</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">utils_logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">log_error</span><span class="p">,</span> <span class="n">log_user_action</span><span class="p">,</span> <span class="n">log_performance</span>

<span class="c1"># Erreurs avec contexte</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_s3</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">log_error</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;data_loading&quot;</span><span class="p">)</span>

<span class="c1"># Actions utilisateur (pour analytics)</span>
<span class="n">log_user_action</span><span class="p">(</span>
    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;filter_applied&quot;</span><span class="p">,</span>
    <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;2024&quot;</span><span class="p">},</span>
    <span class="n">user_id</span><span class="o">=</span><span class="s2">&quot;anonymous&quot;</span>
<span class="p">)</span>

<span class="c1"># Métriques de performance</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">expensive_computation</span><span class="p">()</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="n">log_performance</span><span class="p">(</span><span class="s2">&quot;expensive_computation&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">records</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="configuration-docker">
<h3>Configuration Docker<a class="headerlink" href="#configuration-docker" title="Lien vers cette rubrique"></a></h3>
<p>Les fichiers Docker Compose définissent explicitement l’environnement :</p>
<p><strong>docker-compose-preprod.yml :</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mangetamain_preprod</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_ENV=preprod</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../10_preprod/logs:/app/logs</span>
</pre></div>
</div>
<p><strong>docker-compose-prod.yml :</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mangetamain_prod</span><span class="p">:</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_ENV=prod</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../20_prod/logs:/app/logs</span>
</pre></div>
</div>
</section>
<section id="avantages">
<h3>Avantages<a class="headerlink" href="#avantages" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>✅ <strong>Séparation Prod/Preprod/Local</strong> : Logs distincts automatiquement par environnement</p></li>
<li><p>✅ <strong>Thread-safe</strong> : Compatible Streamlit multithread (<code class="docutils literal notranslate"><span class="pre">enqueue=True</span></code>)</p></li>
<li><p>✅ <strong>Rotation automatique</strong> : Pas de logs géants (taille et temps)</p></li>
<li><p>✅ <strong>Compression</strong> : Économie d’espace disque (.zip)</p></li>
<li><p>✅ <strong>Détection auto</strong> : <code class="docutils literal notranslate"><span class="pre">EnvironmentDetector</span></code> avec cache</p></li>
<li><p>✅ <strong>Backtrace complet</strong> : Debugging simplifié pour erreurs (<code class="docutils literal notranslate"><span class="pre">backtrace=True</span></code>, <code class="docutils literal notranslate"><span class="pre">diagnose=True</span></code>)</p></li>
<li><p>✅ <strong>Tracking utilisateur</strong> : Fichier dédié <code class="docutils literal notranslate"><span class="pre">user_interactions.log</span></code></p></li>
<li><p>✅ <strong>Fonctions utilitaires</strong> : <code class="docutils literal notranslate"><span class="pre">log_error()</span></code>, <code class="docutils literal notranslate"><span class="pre">log_user_action()</span></code>, <code class="docutils literal notranslate"><span class="pre">log_performance()</span></code></p></li>
<li><p>✅ <strong>Rétention différenciée</strong> : 7j preprod, 30j prod pour errors</p></li>
</ul>
</section>
</section>
<section id="performance">
<h2>Performance<a class="headerlink" href="#performance" title="Lien vers cette rubrique"></a></h2>
<section id="optimisations">
<h3>Optimisations<a class="headerlink" href="#optimisations" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p><strong>Cache Streamlit</strong> : <code class="docutils literal notranslate"><span class="pre">&#64;st.cache_data</span></code> (TTL 1h)</p></li>
<li><p><strong>DuckDB columnar</strong> : Requêtes analytiques optimisées</p></li>
<li><p><strong>Polars</strong> : Traitement de données haute performance</p></li>
<li><p><strong>S3 DNAT bypass</strong> : 500-917 MB/s</p></li>
</ul>
</section>
<section id="temps-de-chargement">
<h3>Temps de Chargement<a class="headerlink" href="#temps-de-chargement" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Premier chargement : 5-10 secondes (depuis S3)</p></li>
<li><p>Chargements suivants : &lt;0.1 seconde (cache mémoire)</p></li>
<li><p>Gain : 50-100x sur navigations répétées</p></li>
</ul>
</section>
</section>
<section id="securite">
<h2>Sécurité<a class="headerlink" href="#securite" title="Lien vers cette rubrique"></a></h2>
<section id="bonnes-pratiques">
<h3>Bonnes Pratiques<a class="headerlink" href="#bonnes-pratiques" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Credentials S3 non commités (96_keys/ dans .gitignore)</p></li>
<li><p>Secrets GitHub chiffrés</p></li>
<li><p>Runner isolé sur VPN</p></li>
<li><p>Validation des inputs utilisateurs</p></li>
<li><p>Gestion des exceptions personnalisée</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="modules/infrastructure.html" class="btn btn-neutral float-left" title="Modules Infrastructure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="s3.html" class="btn btn-neutral float-right" title="Stockage S3 Garage" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2025, Mangetamain Team.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>